<!DOCTYPE html>
<html lang="en">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <style>
    * {
        
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Orbitron', sans-serif;


    }

    body {
        background-color: #0f0f1c;
        color: #e0e0e0;
    }

    .header {
        padding-block: 20px;
        text-align: center;
        color: #00ffe7;
        background-color: #1a1a2e;
        font-size: 2rem;
        text-shadow: 0 0 10px #00ffe7;
    }

    main {
        padding-inline: 40px;
    }

    main > h2 {
        color: #42a5f5;
    }

    .container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .add-event-container {
        background-color: #1a1a2e;
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
    }

    .add-event-container h3 {
        text-align: center;
        color: #00ffe7;
    }

    .event-form-container > form div > input {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        background-color: #212135;
        color: #e0e0e0;
        border: 1px solid #3f3f5e;
        border-radius: 5px;
    }

    .btn-add-event,
    .btn-register,
    .btn-view-attendees,
    .btn-edit-event,
    .btn-delete-event {
        outline: none;
        border: none;
        width: 100%;
        padding: 10px;
        color: #0f0f1c;
        background-color: #00ffe7;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        margin-top: 6px;
        transition: background-color 0.3s ease;
    }

    .btn-add-event:hover,
    .btn-register:hover,
    .btn-view-attendees:hover,
    .btn-edit-event:hover,
    .btn-delete-event:hover {
        background-color: #bdb76b;
        color: white;
        transition: background-color 0.3s ease;
    }

    .event-list-container > h2 {
        color: #42a5f5;
        padding-block: 5px;
    }

    .event-lists {
        padding-right: 16px;
        height: 500px;
        overflow-y: auto;
    }

    .event-item {
        list-style-type: none;
        margin-bottom: 10px;
        padding: 20px;
        background-color: #1e1e3f;
        display: flex;
        justify-content: space-between;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.1);
        transition: transform 0.2s ease, background-color 0.3s ease;
    }

    .event-item:hover {
        background-color: #fdf6e3;
        transform: scale(1.01);
        transition: transform 0.2s ease, background-color 0.3s ease;
    }

    .event-item > div:first-child div {
        margin-top: 30px;
    }

    .event-header {
        font-weight: 600;
        font-size: 24px;
        color: #00ffe7;
    }

    .registration-header {
        font-size: 18px;
        color: #ffffff;
        margin-bottom: 10px;
    }

    .registration-container input {
        padding: 8px;
        background-color: #212135;
        color: #e0e0e0;
        border: 1px solid #3f3f5e;
        border-radius: 5px;
    }

    .registration-container div {
        margin-bottom: 7px;
    }

    .event-item p {
        font-weight: 400;
        font-size: 16px;
        color: #cfcfcf;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .modal-content {
        background-color: #1e1e3f;
        padding: 20px;
        width: 80%;
        max-width: 600px;
        max-height: 80%;
        overflow-y: auto;
        position: relative;
        border-radius: 8px;
        color: #e0e0e0;
    }

    .close-btn {
        position: absolute;
        top: 0;
        right: 12px;
        font-size: 30px;
        cursor: pointer;
        color: #ff5252;
    }

    .attendees-lists {
        list-style-type: none;
        padding: 0;
    }

    .attendees-lists li {
        padding: 8px;
        margin: 5px 0;
        background-color: #292954;
        border-radius: 5px;
        color: #00ffe7;
    }

    @media screen and (min-width: 900px) {
        .container {
            flex-direction: row;
        }

        .add-event-container {
            width: 30%;
        }

        .event-list-container {
            padding-inline: 20px;
            width: 70%;
        }
    }
</style>

</style>

        </style>
    </head>
    <body>
        <h1 class="header">Campus Event Management System</h1>

        <main>
            <h2>Events</h2>
            <div class="container">
                <div class="add-event-container">
                    <h3>Add Event</h3>
                    <div class="event-form-container">
                        <form>
                            <div>
                                <label for="title">Event Title</label> <br />
                                <input
                                    id="title"
                                    type="text"
                                    placeholder="Title"
                                />
                            </div>
                            <div>
                                <label for="date">Event Date</label> <br />
                                <input id="date" type="date" min="2025-04-9" />
                            </div>
                            <div>
                                <label for="organizer">Event Organizer</label>
                                <br />
                                <input
                                    id="organizer"
                                    type="text"
                                    placeholder="Organizer"
                                />
                            </div>
                            <button class="btn-add-event">Add Event</button>
                        </form>
                    </div>
                </div>

                <div class="event-list-container">
                    <ul class="event-lists"></ul>
                </div>
            </div>
        </main>



        <script>






            let addEventHeader = document.querySelector(
                ".add-event-container > h3"
            );
            let btnAddEvent =
                document.getElementsByClassName("btn-add-event")[0];
            let eventItems = document.querySelectorAll(".event-item > *");
            let eventId = 0;

            function displayEvents() {
                let eventLists = document.querySelector(".event-lists");

                fetch("http://localhost:3000/events")
                    .then((response) => response.json())
                    .then((data) => {
                        data.forEach((item) => {
                            let event = document.createElement("li");
                            event.className = "event-item";
                            event.dataset.id = item.id;

                            event.innerHTML = `
            <div>
                        <h2 class='event-header'>${item.title}</h2>
                        <p>Date: ${item.date}</p>
                        <p>Organizer: ${item.organizer}</p>
            <div>
                        <button class="btn-view-attendees">View Attendees</button>
                        <button class="btn-edit-event">Edit</button>
                        <button class="btn-delete-event">Delete</button>

                        <!-- Register form moved below buttons -->
                        <div class='registration-container' style="margin-top: 15px;">
                        <h2 class='registration-header'>Register a User</h2>
                <form>
                        <div>
                        <input id='name' type="text" placeholder="Name" />
                        </div>
                        <div>
                        <input id='email' type="email" placeholder="Email" />
                        </div>
                        <button class="btn-register">Register</button>
                        </form>
                        </div>
                        </div>
                        </div>
                        `;


                            eventLists.append(event);
                        });

                        // Now attach event listeners to the dynamically created anchor tags
                        let btnViewAttendees = document.querySelectorAll(
                            ".btn-view-attendees"
                        );
                        let btnViewDetails =
                            document.querySelectorAll(".btn-view-details");
                        let btnEdit =
                            document.querySelectorAll(".btn-edit-event");
                        let btnDelete =
                            document.querySelectorAll(".btn-delete-event");
                        let btnRegister =
                            document.querySelectorAll(".btn-register");

                        btnViewAttendees.forEach((btn) => {
                            btn.addEventListener("click", function (event) {
                                event.preventDefault();
                                let id = getIndex(btn);

                                getAttendeesLists(id);
                            });
                        });

                        btnViewDetails.forEach((btn) => {
                            btn.addEventListener("click", function (event) {
                                event.preventDefault();
                                let id = getIndex(btn);

                                getAttendeesLists(id);
                            });
                        });

                        btnEdit.forEach((btn) => {
                            btn.addEventListener("click", function (event) {
                                event.preventDefault();

                                addEventHeader.textContent = "Edit Event";
                                btnAddEvent.textContent = "Save Changes";

                                let id = getIndex(btn);
                                getEventDetails(id);
                                eventId = id;
                            });
                        });

                        btnDelete.forEach((btn) => {
                            btn.addEventListener("click", function (event) {
                                event.preventDefault();
                                let id = getIndex(btn);

                                deleteEvent(id);
                            });
                        });

                        btnRegister.forEach((btn) => {
                            btn.addEventListener("click", function (event) {
                                event.preventDefault();
                                let id = getIndex(btn);

                                registerUser(id);
                            });
                        });
                    })
                    .catch((error) => {
                        console.log("Error: ", error);
                    });
            }

            document.addEventListener("DOMContentLoaded", function () {
                displayEvents(); // This will display events and set up event listeners
            });

            // Function to get attendees and show them in a modal
            function getAttendeesLists(eventId) {
                // Create modal elements
                let modal = document.createElement("div");
                modal.className = "modal";
                modal.style.position = "fixed";
                modal.style.top = "50%";
                modal.style.left = "52%"; // Move it slightly right but inside your layout
                modal.style.transform = "translateY(-50%)";
                modal.style.display = "flex";
                modal.style.justifyContent = "center";
                modal.style.alignItems = "center";
                modal.style.width = "40vw";  // Limit the width
                modal.style.zIndex = "999";

                let modalContent = document.createElement("div");
                modalContent.className = "modal-content";

                // Close button
                let closeButton = document.createElement("span");
                closeButton.className = "close-btn";
                closeButton.textContent = "x"; // Close symbol
                closeButton.addEventListener("click", () => {
                    modal.style.display = "none"; // Hide modal when close button is clicked
                });

                // Create the list for attendees
                let attendeesContainer = document.createElement("div");
                let attendeesLists = document.createElement("ul");
                attendeesLists.classList = "attendees-lists";

                let attendeesHeader = document.createElement("h3");
                attendeesHeader.textContent = "Attendees Lists";
                attendeesHeader.style.textAlign = "center";

                fetch(`http://localhost:3000/registration/${eventId}`)
                    .then((response) => response.json())
                    .then((data) => {
                        data.forEach((item) => {
                            let user = document.createElement("li");

                            user.innerHTML = `<p>${item.name}</p>`;
                            attendeesLists.append(user);
                        });
                    })
                    .catch((error) => {
                        console.log("Error: ", error);
                    });

                attendeesContainer.append(attendeesLists);

                // Append close button and attendee lists to modal content
                modalContent.append(attendeesHeader);
                modalContent.append(closeButton);
                modalContent.append(attendeesContainer);

                // Append modal content to modal
                modal.append(modalContent);

                // Append the modal to the body
                document.body.append(modal);

                // Display the modal (lightbox)
                modal.style.display = "flex"; // Show modal
            }

            function addEvent() {
                let titleInput = document.getElementById("title").value;
                let dateInput = document.getElementById("date").value;
                let organizerInput = document.getElementById("organizer").value;

                fetch("http://localhost:3000/events", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        title: titleInput,
                        date: dateInput,
                        organizer: organizerInput,
                        attendees: [],
                    }),
                })
                    .then((response) => response.text())
                    .then((data) => {
                        console.log("Success:", data);
                    });
            }

            function updateEvent(id) {
                let titleInput = document.getElementById("title");
                let dateInput = document.getElementById("date");
                let organizerInput = document.getElementById("organizer");

                fetch(`http://localhost:3000/events/${id}`, {
                    method: "PUT", // Use PUT or PATCH for updates
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        titleValue: titleInput.value,
                        dateValue: dateInput.value,
                        organizerValue: organizerInput.value,
                    }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        console.log("Server response:", data);
                        alert("Data updated!");
                    })
                    .catch((error) => {
                        console.error("Error updating data:", error);
                    });
            }

            function deleteEvent(id) {
                fetch(`http://localhost:3000/events/${id}`, {
                    method: "DELETE",
                    headers: {
                        "Content-Type": "application/json",
                    },
                })
                    .then((response) => {
                        if (!response.ok) {
                            return response.text().then((text) => {
                                throw new Error(text);
                            });
                        }
                        return response.text();
                    })
                    .then((data) => {
                        console.log("Success:", data);
                    })
                    .catch((error) => {
                        console.error("Error updating data:", error.message);
                    });
            }

            function getEventDetails(id) {
                let titleInput = document.getElementById("title");
                let dateInput = document.getElementById("date");
                let organizerInput = document.getElementById("organizer");

                fetch(`http://localhost:3000/events/${id}`)
                    .then((response) => response.json())
                    .then((data) => {
                        titleInput.value = data.title;
                        dateInput.value = data.date;
                        organizerInput.value = data.organizer;
                    })
                    .catch((error) => {
                        console.error("Error fetching user:", error);
                    });
            }

            function registerUser(id) {
                let nameInput = document.getElementById("name");
                let emailInput = document.getElementById("email");

                fetch("http://localhost:3000/register", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        eventId: id,
                        name: nameInput.value,
                        email: emailInput.value,
                    }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        console.log("Success:", data);
                    });
            }

            function getIndex(btn) {
                let parent = btn.parentElement;
                let parentContainer = parent.parentElement;
                let root = parentContainer.parentElement;
                let id = root.dataset.id;
                let btnViewDetails = document.querySelectorAll(".btn-view-details");


                return id;
            }

            document.addEventListener("DOMContentLoaded", () => {
                btnAddEvent.addEventListener("click", () => {
                    if (btnAddEvent.textContent === "Add Event") {
                        addEvent();
                    } else if (btnAddEvent.textContent === "Save Changes") {
                        updateEvent(eventId);
                    }
                });
            });

       

       </script>



    </body>


</html>
